---
title: "EDA"
output: html_document
---

```{r}
library(tidyverse)
```

```{r}
Judge <- read_csv("Data/judge_batting_2024.csv")
```

```{r}
#Re-orders the data into time increasing instead of time decreasing
Judge1 <- Judge %>%
  group_by(game_date, inning, pitch_number) %>%
  arrange(desc(game_date), .by_group = TRUE) %>%
  ungroup()
```

```{r}
temp <- Judge1 %>%
  group_by(game_date) %>%
  summarise(pitches = n())

temp

temp2 <- Judge1 %>%
  group_by(game_date) %>%
  filter(description == "ball") %>%
  summarise(balls = n())

temp2
```

The dimensions for the different stats are different.

```{r warning=FALSE}
#If we are missing exactly one date value, then we only want the first term where the date values between the two data-sets are not equal to 0.
which(temp$game_date-temp2$game_date != 0)[1]

temp$game_date[142]

temp2$game_date[142]

Judge1 %>%
  filter(game_date=="2024-09-12")
```

On the September 12th game, Aaron Judge managed to get 1-4 (successful hits-appearances) with no balls called within 5 pitches.

Problem: Using conventional dplyr functions are creating holes in the mutated data that makes collating each new column impossible

Solution: Make my own function that does not create holes in the mutated data such that collating each new column is possible

Function Input: Some event (balls, strikes, hit-fail, hit-success)

Function Output: The updated data frame with the added column

```{r}
#The function
BBJudgeColAdder <- function(input = ""){
  #Local variables containing info that we will use within the function
  Dates <- unique(Judge1$game_date)
  rows <- length(Dates)
  
  #Generate a 0-vector with every game_dates values
  tempDF <- matrix(
    0,
    nrow=rows, ncol=1,
    dimnames=list(
      unique(Judge1$game_date),
      "temp"
    )
  )
  #Game dates are numerical instead of the usual Date style
  
  #Generate the original mutated function. This is needed for the next step
  tempIns <- Judge1 %>%
    group_by(game_date) %>%
    filter(description == input) %>%
    summarise("temp" = n()) %>%
    mutate(game_date = as.numeric(game_date))
  #Subject to change as we will be making our own events column to generalize the process
  
  #We merge the tempIns with the tempDF based on matching game dates. This ensures that 0's are included
  tempDF[paste(tempIns$game_date),] <- tempIns$temp
  dimnames(tempDF) <- list(
    Dates,
    "temp")
  
  #We merge the tempDF values into the global data frame
  temp <- temp %>%
    mutate(`input` = tempDF[,"temp"]) %>%
    rename_with(~ paste0(input), starts_with("nonexistent"), .cols=`input`)
  return(temp)
}
```

Testing the function

```{r}
temp <- BBJudgeColAdder(input = "ball")
```

The function works. Now we can begin the true data cleaning process.

Considering that we have a method to add columns into the big data-set. We should rebuild the data to allow the function to work with some minimal tweaks. This would involve collating both the description and events variables into definitive columns for each game day the batter has. 

```{r}
columns <- unique(Judge1$description)
columns

Judge2 <- Judge1 %>%
  group_by(game_date) %>%
  summarise(pitch = n())

for(i in 1:length(columns)){
  print(columns[i])
  Judge2 <- BBJudgeColAdder(columns[i])
}
```

```{r}
Judge2 <- Judge1 %>%
  filter(description == "hit_into_play") %>%
  mutate(outcome = case_when(
    events == c("single", "double", "triple", "home_run", "sac_fly") ~ "HitGood",
    events != c("single", "double", "triple", "home_run", "sac_fly") ~ "HitBad"
    )
  ) %>%
  mutate(week = as.numeric(strftime(game_date, format = "%V"))) %>%
  mutate(week = week-min(week)+1)
```

```{r}
BBJudgeColAdder <- function(input = ""){
  #Local variables containing info that we will use within the function
  Dates <- unique(Judge2$game_week)
  rows <- length(Dates)
  
  #Generate a 0-vector with every game_dates values
  tempDF <- matrix(
    0,
    nrow=rows, ncol=1,
    dimnames=list(
      Dates,
      "temp"
    )
  )
  #Game dates are numerical instead of the usual Date style
  
  #Generate the original mutated function. This is needed for the next step
  tempIns <- Judge2 %>%
    group_by(week) %>%
    filter(outcome == input) %>%
    summarise("temp" = n())
  #Subject to change as we will be making our own events column to generalize the process
  
  #We merge the tempIns with the tempDF based on matching game dates. This ensures that 0's are included
  tempDF[paste(tempIns$week),] <- tempIns$temp
  dimnames(tempDF) <- list(
    Dates,
    "temp")
  
  #We merge the tempDF values into the global data frame
  temp <- temp %>%
    mutate(`input` = tempDF[,"temp"]) %>%
    rename_with(~ paste0(input), starts_with("nonexistent"), .cols=`input`)
  return(temp)
}
```

```{r}
Judge3 <- cbind(
  Judge2 %>%
    group_by(week) %>%
    summarise(hits = n()),
  Judge2 %>%
    group_by(week) %>%
    filter(outcome=="HitBad")%>%
    summarise(`bad hits` = n()) %>%
    select(`bad hits`),
  Judge1 %>%
    mutate(week = as.numeric(strftime(game_date, format = "%V")), 
           week = week-min(week)+1)%>%
    group_by(week)%>%
    summarise(pitches = n()) %>%
    select(pitches)
  )%>%
  mutate(`good hits` = `hits` - `bad hits`)
```




